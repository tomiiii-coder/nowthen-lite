<!DOCTYPE html>
<html lang="ja">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>NowThen Lite</title>
  <style>
  
  #container {
    display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
  }

    body {
      /* display: flex;*/
      /* justify-content: center;*/
      font-family: 'Helvetica Neue', sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
      margin: 0;
    }

    button {
      margin: 4px;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    .task-item {
      display: inline-flex;
      align-items: center;
      margin-right: 8px;
    }

    .delete-btn {
      background: none;
      border: none;
      color: red;
      font-weight: bold;
      cursor: pointer;
      margin-left: 4px;
    }

    .delete-btn:hover {
      background-color: #ffe5e5;
    }

    #container {
      max-width: 700px;
      margin: 40px auto;
      padding: 24px;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    #dateNav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
      font-size: 10px;
    }

    #dateLabel {
      font-weight: bold;
      font-size: 20px;
      align-items: center;
    }

    #taskInputRow {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }

    #newTask {
      font-size: 10px;
      width: 160px;
      padding: 6px;
    }

    #taskColor {
      width: 40px;
      height: 40px;
      padding: 0;
      border: none;
      background: none;
    }

    #currentTask {
      font-size: 14px;
      margin-bottom: 6px;
    }

    #logNote {
      width: 100%;
      height: 60px;
      margin: 4px 0 16px;
      padding: 6px;
      font-size: 13px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    table.simple-table {
      width: 100%;
      font-family: sans-serif;
      font-size: 13px;
      border-collapse: collapse;
      line-height: 1.4;
      margin: 0;
      padding: 0;
    }

    table.simple-table td {
      padding: 2px 4px 6px;
      vertical-align: top;
    }

    #log {
      margin: 0;
      padding: 0;
    }

    #timelineContainer {
      display: flex;
      height: 1440px;
      border-top: 1px solid #ccc;
      margin-bottom: 24px;
    }

    #timeAxis div {
     height: 60px;
     font-size: 12px;
     padding: 0 4px;
    }

    #taskTimeline {
      flex: 1;
      position: relative;
      min-height: 1440px; /* â† ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãŒä¸Šã‹ã‚‰é †ã«ä¸¦ã¶ãŸã‚ã®å›ºå®šé«˜ã• */
      background-color: #f9f9f9;
    }

    #summary table {
      border-collapse: collapse;
      font-size: 14px;
      line-height: 1.4;
    }

    #summary td {
      padding: 2px 6px;
    }

    canvas#barChart {
      width: 100%;
      max-width: 600px;
      height: auto;
     display: block;
    }

      @media (max-width: 600px) {
      body {
        padding: 10px;
      }

    #barChart {
  width: 100%;
  height: 300px; /* or whatever fits */
  max-width: 600px;
  display: block;
}

    
    @media (max-width: 600px) {
      #timeAxis {
        flex-shrink: 0;
      }

      #taskTimeline {
      min-width: 300px; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¢ºä¿ç”¨ */
      }
   }
    
    #container {
      padding: 16px;
      margin: 0;
    }
   
    #taskInputRow {
      flex-direction: column;
      align-items: stretch;
    }
   
    #newTask {
      width: 100%;
    }
   
    button {
      font-size: 16px;
      padding: 10px;
      width: 100%;
    }
   
    #taskButtons {
      overflow-x: auto;   /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã—ã¤ã¤ */
      scrollbar-width: none;  /* Firefoxç”¨ */
      -ms-overflow-style: none;  /* IEç”¨ */
    }

    #taskButtons::-webkit-scrollbar {
      display: none;  /* Chrome/Safariç”¨ */
    } 
   
    .task-item {
      width: 100%;
      justify-content: space-between;
    }

   
    #summary table, #log table {
      font-size: 11px;
    }
   
    #logNote {
      height: 50px;
    }

    
  </style>
</head>
<body>
  <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div id="authSection">
    <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
    <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <button onclick="signup()">æ–°è¦ç™»éŒ²</button>
    <p id="authStatus"></p>
  </div>
  
  <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ -->
  <div id="container" style="display: none;">
    <h2>NowThen Lite</h2>

    <div id="dateNav">
      <button onclick="changeDay(-1)">â—€ å‰ã¸</button>
      <span id="dateLabel"></span>
      <button onclick="changeDay(1)">æ¬¡ã¸ â–¶</button>
    </div>

    <label>â– é›†è¨ˆç¯„å›²ï¼š</label>
    <select id="viewMode" onchange="renderAll()">
      <option value="day">æ—¥åˆ¥</option>
      <option value="week">é€±åˆ¥</option>
      <option value="month">æœˆåˆ¥</option>
    </select>

    <div id="taskInputRow">
      <input type="text" id="newTask" placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯å">
      <input type="color" id="taskColor" value="#00ccff">
      <button onclick="addTask()">è¿½åŠ </button>
    </div>
    <div id="taskButtons"></div>

    <h3>â– ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯</h3>
    <div id="currentTask">ãªã—</div>
    <textarea id="logNote" placeholder="ï¼ˆä»»æ„ï¼‰çµ‚äº†æ™‚ã«ãƒ¡ãƒ¢ã‚’æ®‹ã™"></textarea>

    <h3>â– ãƒ•ãƒªãƒ¼ãƒ¡ãƒ¢</h3>
    <textarea id="freeMemo" placeholder="è‡ªç”±ã«ãƒ¡ãƒ¢ã‚’æ›¸ã„ã¦ãã ã•ã„" style="width:100%; height:100px; font-size:14px; margin-bottom:20px;"></textarea>

    <h3>â– åˆè¨ˆæ™‚é–“</h3>
    <div id="summary"></div>

    <h3>â– ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h3>
    <div id="timelineContainer">
      <div id="timeAxis"></div>
      <div id="taskTimeline"></div>
    </div>

    <h3>â– ã‚°ãƒ©ãƒ•</h3>
    <canvas id="barChart"></canvas>
    
    <h3>â– ãƒ­ã‚°</h3>
     <div id="log"></div>
    </div>
   
  <!-- Chart.jsãªã© -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase (äº’æ›ç‰ˆCDN) -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
 
  <script>
  // Firebase è¨­å®š
  const firebaseConfig = {
    apiKey: "AIzaSyDEKYSMzvxW8yl5GVLAK94BUfd_2e5_uIM",
    authDomain: "nowthenlite.firebaseapp.com",
    projectId: "nowthenlite",
    storageBucket: "nowthenlite.firebasestorage.app",
    messagingSenderId: "951657127118",
    appId: "1:951657127118:web:c629a33504e803a934849f"
  };


  // âœ… åˆæœŸåŒ–
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // âœ… æ–°è¦ç™»éŒ²
  function signup() {
    const email = document.getElementById("email").value;
    const pw = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, pw)
      .then(() => {
        document.getElementById("authStatus").textContent = "ç™»éŒ²æˆåŠŸï¼";
      })
      .catch(e => {
        document.getElementById("authStatus").textContent = "ç™»éŒ²ã‚¨ãƒ©ãƒ¼ï¼š" + e.message;
      });
  }

  // âœ… ãƒ­ã‚°ã‚¤ãƒ³
  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        document.getElementById("authStatus").textContent = "ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼";
      })
      .catch(err => {
        document.getElementById("authStatus").textContent = "ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—ï¼š" + err.message;
      });
  }

  // âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
  function logout() {
    auth.signOut().then(() => {
      document.getElementById("authStatus").textContent = "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ";
    });
  }

  // âœ… ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç›£è¦–ã—ã¦ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
  auth.onAuthStateChanged(user => {
    const app = document.getElementById("container");
    const authUI = document.getElementById("authSection");
    if (user) {
      app.style.display = "block";
      authUI.style.display = "none";
    } else {
      app.style.display = "none";
      authUI.style.display = "block";
    }
  });

  // ğŸ” èµ·å‹•æ™‚ã«å¾©å…ƒ ãƒ•ãƒªãƒ¼ãƒ¡ãƒ¢
window.addEventListener("load", () => {
  const memo = localStorage.getItem("freeMemo") || "";
  document.getElementById("freeMemo").value = memo;
});

// ğŸ’¾ å…¥åŠ›ã”ã¨ã«ä¿å­˜ï¼ˆ1æ–‡å­—æ‰“ã¤ãŸã³ï¼‰ ãƒ•ãƒªãƒ¼ãƒ¡ãƒ¢
document.getElementById("freeMemo").addEventListener("input", (e) => {
  localStorage.setItem("freeMemo", e.target.value);
});

  </script>


  <script>

  // --- åˆæœŸå¤‰æ•°ã¨è¦ç´ ã®å–å¾— ---

  // ã‚¿ã‚¹ã‚¯ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢
  const taskButtonsDiv = document.getElementById("taskButtons");
  // ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯åã¨é–‹å§‹æ™‚åˆ»ã®è¡¨ç¤ºã‚¨ãƒªã‚¢
  const currentTaskDiv = document.getElementById("currentTask");
  // ã‚¿ã‚¤ãƒ ãƒ­ã‚°ã®è¡¨ç¤ºã‚¨ãƒªã‚¢
  const logDiv = document.getElementById("log");
  //JavaScriptã«ã‚°ãƒ©ãƒ•æç”»å‡¦ç†ã‚’è¿½åŠ  ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
  let barChart = null; // ã‚°ãƒ©ãƒ•ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä¿æŒ
  // ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯å
  let currentTask = null;
  // ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ã®é–‹å§‹æ™‚åˆ»ï¼ˆISOå½¢å¼ï¼‰
  let startTime = null;
  // ç™»éŒ²æ¸ˆã¿ã®ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’localStorageã‹ã‚‰å–å¾—ï¼ˆãªã‘ã‚Œã°ç©ºé…åˆ—ï¼‰
  let tasksRaw = JSON.parse(localStorage.getItem("tasks") || "[]");
  let tasks = tasksRaw.map(t => typeof t === "string" ? { name: t, color: "#999999" } : t);
  // ãƒ­ã‚°ï¼ˆé–‹å§‹ãƒ»çµ‚äº†æ™‚é–“ãƒ»ã‚¿ã‚¹ã‚¯åï¼‰ã‚‚localStorageã‹ã‚‰å–å¾—
  let logs = JSON.parse(localStorage.getItem("logs") || "[]");

  // --- ã‚¿ã‚¹ã‚¯è¡¨ç¤ºãƒ»è¿½åŠ ãƒ»å‰Šé™¤ ---

  // ã‚¿ã‚¹ã‚¯ãƒœã‚¿ãƒ³ã‚’ç”»é¢ã«è¡¨ç¤ºï¼ˆï¼‹å‰Šé™¤ãƒœã‚¿ãƒ³ä»˜ãï¼‰
  function renderTasks() {
    taskButtonsDiv.innerHTML = ""; // ä¸€æ—¦ã‚¯ãƒªã‚¢
    tasks.forEach((task, index) => {
      const wrapper = document.createElement("div");
      wrapper.className = "task-item";

      const btn = document.createElement("button");
      btn.textContent = task.name;
      btn.onclick = () => switchTask(task.name); // â† åå‰ã ã‘æ¸¡ã™ // åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½

      const del = document.createElement("button");
      del.textContent = "âŒ";
      del.className = "delete-btn";
      del.title = "å‰Šé™¤";
      del.onclick = () => deleteTask(index);

      wrapper.appendChild(btn);
      wrapper.appendChild(del);
      taskButtonsDiv.appendChild(wrapper);
    });
  }

  // ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¦å†æç”»ï¼ˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚ã‚Šï¼‰
  function deleteTask(index) {
    if (confirm(`ã€Œ${tasks[index]}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
      tasks.splice(index, 1);
      localStorage.setItem("tasks", JSON.stringify(tasks));
      renderTasks();
    }
  }

  // æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚ã‚Šï¼‰
  function addTask() {
    const input = document.getElementById("newTask");
    const colorInput = document.getElementById("taskColor");
    const name = input.value.trim();
    const color = colorInput.value;

    if (name && !tasks.some(t => t.name === name)) {
      tasks.push({ name, color });
      localStorage.setItem("tasks", JSON.stringify(tasks));
      renderTasks();
    }
    input.value = "";
  }


  // --- ã‚¿ã‚¹ã‚¯åˆ‡ã‚Šæ›¿ãˆãƒ»è¨˜éŒ² ---

  // ã‚¿ã‚¹ã‚¯ã‚’åˆ‡ã‚Šæ›¿ãˆ â†’ ãƒ­ã‚°è¨˜éŒ² â†’ è¡¨ç¤ºæ›´æ–°
  function switchTask(newTask) {
    const now = new Date();

    // å‰ã®ã‚¿ã‚¹ã‚¯ã‚’ãƒ­ã‚°ã«ä¿å­˜
    if (currentTask) {
      const noteInput = document.getElementById("logNote");
      const note = noteInput ? noteInput.value.trim() : "";

      logs.push({
        task: currentTask,
        start: startTime,
        end: now.toISOString(),
        note: note || "" // ãƒ¡ãƒ¢ãŒç©ºã§ã‚‚ç©ºæ–‡å­—ã¨ã—ã¦è¨˜éŒ²
      });
      localStorage.setItem("logs", JSON.stringify(logs));
      if (noteInput) noteInput.value = "";  // ãƒ¡ãƒ¢æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
    }

    // æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã«åˆ‡ã‚Šæ›¿ãˆ
    currentTask = newTask;
    startTime = now.toISOString();

    updateCurrent();
    renderLog();
  }

  // ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ã‚’ç”»é¢ã«è¡¨ç¤º
  function updateCurrent() {
    if (currentTask) {
      const start = new Date(startTime);
      const now = new Date();
      const diffMin = Math.floor((now - start) / 60000); // åˆ†å˜ä½ã®å·®åˆ†

      const label = `${currentTask}ï¼ˆ${start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}ã€œï¼‰ã€Š${diffMin}åˆ†çµŒéã€‹`;
      currentTaskDiv.textContent = label;
    } else {
      currentTaskDiv.textContent = "ãªã—";
    }
  }


  // --- æ—¥ä»˜ã”ã¨ã®ãƒ­ã‚°ã¨é›†è¨ˆ ---

  // ç¾åœ¨ã®è¡¨ç¤ºå¯¾è±¡æ—¥ï¼ˆ0ï¼ä»Šæ—¥ã€-1ï¼æ˜¨æ—¥ï¼‰
  let dayOffset = 0;

  // è¡¨ç¤ºå¯¾è±¡ã®æ—¥ä»˜ã‚’Dateå‹ã§è¿”ã™
  function getTargetDate() {
    const d = new Date();
    d.setDate(d.getDate() + dayOffset);
    return d;
  }

  // æ—¥ä»˜ãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤ºï¼ˆä¾‹ï¼šğŸ“… 03/23ï¼ˆåœŸï¼‰ï¼‰
  function renderDateLabel() {
    const mode = document.getElementById("viewMode").value;
    const baseDate = getTargetDate();
    let label = "";
  
    if (mode === "day") {
      label = baseDate.toLocaleDateString("ja-JP", { month: '2-digit', day: '2-digit', weekday: 'short' });
    } else if (mode === "week") {
      const start = new Date(baseDate);
      start.setDate(start.getDate() - start.getDay()); // é€±ã®é–‹å§‹ï¼ˆæ—¥æ›œæ—¥ï¼‰
  
      const end = new Date(start);
      end.setDate(start.getDate() + 6); // åœŸæ›œæ—¥
  
      const startStr = `${start.getMonth() + 1}/${start.getDate()}`;
      const endStr = `${end.getMonth() + 1}/${end.getDate()}`;
      label = `${startStr}ã€œ${endStr}`;
    } else if (mode === "month") {
      label = `${baseDate.getFullYear()}å¹´${baseDate.getMonth() + 1}æœˆ`;
    }
  
    document.getElementById("dateLabel").textContent = `ğŸ“… ${label}`;
  }
  
  // æ—¥ä»˜ã‚’å¤‰æ›´ï¼ˆâ† å‰æ—¥ã€â†’ æ¬¡æ—¥ï¼‰
  function changeDay(delta) {
    const mode = document.getElementById("viewMode").value;
    if (mode === "day") {
      dayOffset += delta;
    } else if (mode === "week") {
      dayOffset += delta * 7;
    } else if (mode === "month") {
      const current = getTargetDate();
      current.setMonth(current.getMonth() + delta);
      const today = new Date();
      dayOffset = Math.floor((current - today) / (1000 * 60 * 60 * 24));
    }
  
    renderDateLabel();
    renderLog();
  }

  // --- ãƒ­ã‚°ã¨åˆè¨ˆæ™‚é–“ã®è¡¨ç¤º ---

  // æŒ‡å®šæ—¥ã®ãƒ­ã‚°ã‚’è¡¨ç¤ºï¼ˆçµŒéæ™‚é–“ä»˜ãï¼‰
  function renderLog() {
    const mode = document.getElementById("viewMode").value;
    const baseDate = getTargetDate();
  
    const logRows = getTargetRangeLogs().map(log => {
      const s = new Date(log.start);
      const e = new Date(log.end);
      const durationMs = e - s;
      const mins = Math.floor(durationMs / 60000);
      const hrs = Math.floor(mins / 60);
      const rem = mins % 60;
      const durationStr = hrs > 0 ? `${hrs}æ™‚é–“${rem}åˆ†` : `${rem}åˆ†`;
      const memo = log.note ? `ğŸ““ ${log.note}` : "";
  
      const startStr = s.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const endStr = e.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  
      return `
        <tr>
          <td style="width: 80px; white-space: nowrap;">${startStr} - ${endStr}</td>
          <td style="width: 100px;">ï¼ˆ${durationStr}ï¼‰</td>
          <td style="width: 100px;">${log.task}</td>
          <td>${memo}</td>
        </tr>
      `;
    }).join("");
  
    logDiv.innerHTML = `
      <table style="width: 100%; font-family: sans-serif; font-size: 12px; border-collapse: collapse;">
        ${logRows}
      </table>
    `;
  
    renderSummary();
    renderTimeline();
  }

    
  //JavaScriptã§æç”»ã™ã‚‹é–¢æ•°ã‚’ä½œæˆ
  function renderTimeline() {
    const mode = document.getElementById("viewMode").value;
    const timelineContainer = document.getElementById("timelineContainer");
    const container = document.getElementById("taskTimeline");
    const timeAxis = document.getElementById("timeAxis");
  
    // æ—¥åˆ¥ä»¥å¤–ã§ã¯ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³éè¡¨ç¤ºã«ã™ã‚‹
    if (mode !== "day") {
      timelineContainer.style.display = "none";  // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å…¨ä½“ã‚’éè¡¨ç¤º
      return;
    } else {
      timelineContainer.style.display = "flex";  // è¡¨ç¤ºã‚’å¾©æ´»
    }
    
    const targetDate = getTargetDate().toDateString();
  
    // ãƒªã‚»ãƒƒãƒˆ
    container.innerHTML = "";
    timeAxis.innerHTML = "";
  
    // â–¼ æ™‚é–“ç›®ç››ã‚Šï¼ˆ1æ™‚é–“ã”ã¨ï¼‰
    for (let h = 0; h < 24; h++) {
      const label = document.createElement("div");
      label.style.height = "60px";
      label.style.fontSize = "12px";
      label.textContent = `${String(h).padStart(2, "0")}:00`;
      timeAxis.appendChild(label);
    }
  
    // â–¼ ãƒ­ã‚°ã‹ã‚‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’æç”»ï¼ˆâ€»getTargetRangeLogsã§æ—¥ä»˜ä¸€è‡´ã®ã¿å–å¾—ï¼‰
    getTargetRangeLogs().forEach(log => {
      const s = new Date(log.start);
      const e = new Date(log.end);
      
      if (s.toDateString() !== targetDate) return;
  
      const startMin = s.getHours() * 60 + s.getMinutes();
      const endMin = e.getHours() * 60 + e.getMinutes();
      const duration = endMin - startMin;
  
      const block = document.createElement("div");
      block.style.position = "absolute";
      block.style.top = `${startMin}px`;
      block.style.height = `${duration}px`;
      block.style.left = "10px";
      block.style.right = "10px";
  
      const taskObj = tasks.find(t => t.name === log.task);
      const color = taskObj ? taskObj.color : stringToColor(log.task);
      
      block.style.backgroundColor = color;
      block.style.borderRadius = "4px";
      block.style.padding = "2px 4px";
      block.style.fontSize = "12px";
      block.style.color = "#fff";
      block.textContent = `${log.task}`;
      container.appendChild(block);
    });
  }
  
  function renderAll() {
    renderDateLabel();
    renderLog();
  }

  // ã‚¿ã‚¹ã‚¯åã‹ã‚‰è‰²ã‚’ç”Ÿæˆï¼ˆå®‰å®šã—ãŸãƒ©ãƒ³ãƒ€ãƒ ã‚«ãƒ©ãƒ¼ï¼‰
  function stringToColor(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      hash = str.charCodeAt(i) + ((hash << 5) - hash);
    }
    const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
    return "#" + "00000".substring(0, 6 - c.length) + c;
  }

  // æŒ‡å®šæ—¥ã®ã‚¿ã‚¹ã‚¯ã”ã¨ã®åˆè¨ˆæ™‚é–“ã‚’è¡¨ç¤º
  function renderSummary() {
    const summary = {};
    const targetDate = getTargetDate().toDateString();
  
    logs.forEach(log => {
      const s = new Date(log.start);
      const e = new Date(log.end);
      if (s.toDateString() === targetDate) {
        const mins = Math.floor((e - s) / 60000);
        summary[log.task] = (summary[log.task] || 0) + mins;
      }
    });
  
    // â‘ ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºéƒ¨åˆ†ï¼ˆæ”¹è¡Œå¯¾å¿œï¼‰
    const entries = Object.entries(summary);

    // ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã®HTMLã‚’ç”Ÿæˆ
    const rows = entries.map(([task, mins]) => {
      const hrs = Math.floor(mins / 60);
      const rem = mins % 60;
      const timeStr = `${hrs > 0 ? `${hrs}æ™‚é–“` : ""}${rem}åˆ†`;
      return `<tr><td style="padding-right: 1em;">${task}</td><td>ï¼š</td><td>${timeStr}</td></tr>`;
    });

    document.getElementById("summary").innerHTML = `
      <table style="font-family: sans-serif; font-size: 14px;">
        ${rows.join("")}
      </table>
    `;
  
    // â‘¡ ã“ã“ã‹ã‚‰ä¸‹ãŒChart.jsè¿½åŠ éƒ¨åˆ†ï¼
      const ctx = document.getElementById("barChart").getContext("2d");

      barChart = new Chart(ctx, {
  type: 'bar',
  data: { /* ãƒ‡ãƒ¼ã‚¿ */ },
  options: {
    responsive: true,       // â† å¿…é ˆï¼
    maintainAspectRatio: false,  // â† é«˜ã•ã‚’CSSã§åˆ¶å¾¡ã™ã‚‹ãªã‚‰
    scales: {
      y: { /* ... */ }
    }
  }
});
    const labels = Object.keys(summary);
    const data = Object.values(summary).map(mins => (mins / 60).toFixed(2)); // æ™‚é–“å˜ä½
  
    if (barChart) {
      barChart.destroy();
    }
  
    // ã‚¿ã‚¹ã‚¯åã«å¯¾å¿œã™ã‚‹è‰²ã‚’ tasks é…åˆ—ã‹ã‚‰å–å¾—
    const backgroundColors = labels.map(label => {
      const t = tasks.find(t => t.name === label);
      return t ? t.color : "#999999"; // æœªç™»éŒ²ãªã‚‰ã‚°ãƒ¬ãƒ¼
    });

    barChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'ä½œæ¥­æ™‚é–“ï¼ˆæ™‚é–“ï¼‰',
          data: data,
          backgroundColor: backgroundColors, // â† è¿½åŠ ï¼
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            min: 0,
            max: 5, // â† æœ€å¤§æ™‚é–“ã‚’å›ºå®šï¼ˆä»»æ„ï¼‰
            ticks: {
              stepSize: 1, // 1æ™‚é–“ã”ã¨ã«ç›®ç››ã‚Š
              callback: function(value) {
                return value + "h"; // ãƒ©ãƒ™ãƒ«ã‚’ "1h" ã®ã‚ˆã†ã«
              }
            },
            title: {
              display: true,
              text: 'æ™‚é–“'
            }
          }
        }
      }
    });
  }
  
  function getTargetRangeLogs() {
   const mode = document.getElementById("viewMode").value;
   const today = new Date();
   today.setDate(today.getDate() + dayOffset);
   today.setHours(0, 0, 0, 0);
 
   return logs.filter(log => {
     const s = new Date(log.start);
     s.setHours(0, 0, 0, 0);
 
     if (mode === "day") {
       return s.getTime() === today.getTime();
     } else if (mode === "week") {
       const startOfWeek = new Date(today);
       startOfWeek.setDate(today.getDate() - today.getDay());
       const endOfWeek = new Date(startOfWeek);
       endOfWeek.setDate(startOfWeek.getDate() + 6);
       return s >= startOfWeek && s <= endOfWeek;
     } else if (mode === "month") {
       return s.getFullYear() === today.getFullYear() && s.getMonth() === today.getMonth();
     }
     return false;
   });
 }



  // --- åˆæœŸæç”»å‡¦ç†ï¼ˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ï¼‰ ---

  renderTasks();        // ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’æç”»
  renderDateLabel();    // æ—¥ä»˜ã‚’è¡¨ç¤º
  renderLog();          // å½“æ—¥ã®ãƒ­ã‚°ã‚’è¡¨ç¤º
  updateCurrent();      // ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
  
  setInterval(updateCurrent, 60000); // 60ç§’ã”ã¨ã«æ›´æ–°
  </script>
</body>
</html>
